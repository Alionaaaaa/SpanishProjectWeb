@model Domain.Models.Quiz.QuizViewModel

@{
    ViewData["Title"] = "Întrebările testului";
}


<style>
    /* Stiluri pentru adăugarea spațiului de sus */
    .add-element-section {
        margin-top: 50px;
    }

        /* Stiluri pentru secțiunea de adăugare a întrebării */
        .add-element-section .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid #ccc;
            padding: 20px;
        }

        .add-element-section .content {
            flex-grow: 1;
            text-align: center;
        }

        .add-element-section .button-container {
            margin-left: 30px;
        }

    /* CSS pentru stilizarea întrebărilor */
    .question {
        font-size: 23px;
        font-weight: bold;
        color: #8a2be2; /* Albastru închis */
    }

    /* CSS pentru stilizarea opțiunilor de răspuns */
    .option {
        font-size: 20px;
        color: black; /* Violet */
    }

    /* Stilizează întrebările */
    #scoreValue {
        font-size: 16px;
        color: orange;
        text-align: center;
        margin-top: 10px;
    }

    /* CSS pentru stilizarea întrebărilor */
    .question-container {
        border: 1px solid #ccc;
        padding: 20px;
        margin-bottom: 20px;
        background-color: #f9f9f9; /* culoare fundal dreptunghi */
    }

    /* CSS pentru stilizarea opțiunilor de răspuns */
    .option-container {
        border: 1px solid #ccc;
        padding: 10px;
        margin-top: 10px;
        background-color: #f9f9f9; /* culoare fundal dreptunghi */
        display: flex; /* face ca containerul să folosească flexbox */
        align-items: center; /* aliniază opțiunile pe axa verticală */
    }

        .option-container .option {
            flex-grow: 1; /* face ca opțiunea să ocupe tot spațiul disponibil */
        }

    /* Stilizează opțiunile de răspuns pentru răspunsul corect */
    .correct-answer {
        background-color: #c8e6c9; /* Verde deschis */
    }

    /* Stilizează opțiunile de răspuns pentru răspunsul greșit */
    .wrong-answer {
        background-color: #ffcdd2; /* Roșu deschis */
    }
</style>

@if (User.IsInRole("Moderator"))
{
    <div class="add-element-section">
        <div class="container">
            <div class="content">
                <h5>Adăugați o nouă întrebare la test</h5>
            </div>
            <div class="button-container">
                <a asp-action="AddQuestion" asp-controller="QuizQuestion" asp-route-quizId="@Model.Id" class="btn btn-primary">Adăugați </a>
            </div>
        </div>
    </div>
}
<br />

@if (Model.Questions.Any())
{
    <form id="quizForm">
        <input type="hidden" name="quizId" value="@Model.Id" />
        @for (var i = 0; i < Model.Questions.Count; i++)
        {
            var question = Model.Questions[i];
            <div class="question-container">
                <div class="question">
                    <strong style="font-size: 25px;">@question.QuestionText</strong><br />

                    <div class="option-container ">
                        <label class="option"><input type="radio" name="answers[@i]" value="A" />  A| @question.A </label><br />
                    </div>

                    <div class="option-container">
                        <label class="option"><input type="radio" name="answers[@i]" value="B" />  B| @question.B </label><br />
                    </div>
                    <div class="option-container">
                        <label class="option"><input type="radio" name="answers[@i]" value="C" />  C| @question.C </label><br />
                    </div>
                    <div class="option-container">
                        <label class="option"><input type="radio" name="answers[@i]" value="D" />  D| @question.D </label><br />
                    </div>
                    <span id="rightAnswer_@i" style="display:none;">Răspunsul corect: @question.RightAnswer</span><br />
                    <span id="correctAnswerMessage_@i" style="display:none;">
                        Răspunsul corect este: (@question.RightAnswer)
                        @{
                            // Determină care dintre opțiunile A, B, C, sau D este corectă
                            string correctOptionText = "";
                            if (question.RightAnswer == "A")
                            {
                                correctOptionText = question.A;
                            }
                            else if (question.RightAnswer == "B")
                            {
                                correctOptionText = question.B;
                            }
                            else if (question.RightAnswer == "C")
                            {
                                correctOptionText = question.C;
                            }
                            else if (question.RightAnswer == "D")
                            {
                                correctOptionText = question.D;
                            }
                        }
                        @correctOptionText
                    </span>

                </div>
            </div>
            <hr />
        }
        <button type="button" onclick="submitAnswers()" class="btn btn-primary">Trimiteți răspunsurile</button>
        <p id="scoreValue"></p>
    </form>
}
else
{
    <p>No questions found for this quiz.</p>
}

<script>
    function submitAnswers() {
        // Obțineți formularul
        var quizForm = document.getElementById("quizForm");

        // Obțineți toate elementele radio din formular
        var answerInputs = quizForm.querySelectorAll("input[type=radio]:checked");

        // Inițializați scorul
        var score = 0;

        // Iterați prin fiecare element radio selectat și obțineți valoarea răspunsului și răspunsul corect corespunzător
        answerInputs.forEach(function (input) {
            var questionIndex = input.name.split('[')[1].split(']')[0]; // Obțineți indexul întrebării
            var correctAnswer = document.getElementById("rightAnswer_" + questionIndex).innerText.split(':')[1].trim(); // Obțineți răspunsul corect

            // Verificați dacă răspunsul dat de utilizator este corect și adăugați un punct la scor dacă este
            if (input.value.trim().toUpperCase() === correctAnswer.trim().toUpperCase()) {
                score++;
                input.parentElement.classList.add('correct-answer'); // Adăugați clasa CSS pentru răspuns corect
            } else {
                input.parentElement.classList.add('wrong-answer'); // Adăugați clasa CSS pentru răspuns greșit
            }
            // Afizați răspunsul corect
            var correctAnswerMessage = document.getElementById("correctAnswerMessage_" + questionIndex);
            correctAnswerMessage.style.display = "inline";
        });

        // Afizați scorul într-un element separat
        var scoreValue = document.getElementById("scoreValue");
        scoreValue.innerText = "Scor: " + score + " / " + answerInputs.length;
    }
</script>
